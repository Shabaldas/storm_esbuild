<div data-controller="calculator">
  <%= simple_form_for @print_model, url: manage_print_models_path, html: { data: { calculator_target: "form" } } do |f| %>
    <div id="print_model_id_field">
      <%= turbo_stream.update("print_model_id_field") do %>
        <%= f.input :id, as: :hidden, input_html: { value: @print_model.id, id: @print_model.id } %>
      <% end %>
    </div>
    <%= f.input :size, as: :hidden, input_html: { data: { calculator_target: "sizeField" } } %>
    <%= f.input :weight, as: :hidden, input_html: { data: { calculator_target: "weightField" } } %>
    <%= f.input :volume, as: :hidden, input_html: { data: { calculator_target: "volumeField" } } %>
    <div class="w-full h-full max-w-screen-2xl mx-auto relative top-2 z-20" data-controller="upload-model">
      <div class="block pb-14 mt-8 px-7 mt-8 overflow-hidden lg:mx-auto lg:flex lg:justify-between md:px-24" data-controller="sidebar">
        <div class="w-full xl:w-2/3">
          <section>
            <div class="w-full flex flex-col justify-center items-center border-2 border-dashed border-zinc-400 rounded-2x h-[420px] md:h-[544px]" data-upload-model-target="uploadContainer" data-calculator-target="uploadContainer">
              <div class="flex">
                <div class="w-32">
                  <%= image_tag("calculator_img/file_expanding1.png") %>
                </div>
              </div>
              <div class="w-full mx-auto flex flex-col justify-center items-center md:w-1/2">
                <p class="text-base text-gray-500 text-center px-2 w-[220px]">
                  <%= t("calculator.model.format_explaining") %>
                </p>
                <button class="relative p-4 mt-10 bg-yellow-400 rounded-lg text-base text-center font-medium uppercase cursor-pointer sm:text-xl">
                  <%= f.input :file, as: :file, label: false, input_html: { id: "file", accept: ".stl", required: true, class: "w-full h-full absolute top-0 left-0 opacity-0 cursor-pointer", data: { action: "change->calculator#onDropFile" } } %>
                  <p>
                    <%= t("calculator.btns.upload_model") %>
                  </p>
                </button>
              </div>
            </div>
            <div data-upload-model-target="viewContainer" style="display: none;">
              <div class="w-full relative rounded-2xl h-[544px]">
                <div id="scene" data-calculator-target="scene"></div>
                <div class="w-12 mt-6 ml-6 absolute top-2 left-2 bg-white flex flex-col justify-center items-center px-2 py-1 rounded-lg">
                  <button class="mt-2 mb-2" data-action="click->calculator#toggleZoom" data-calculator-zoom-type-param="zoomIn">
                    <%= image_tag("calculator_img/zoom_in.png") %>
                  </button>
                  <button class="mt-2 mb-2" data-action="click->calculator#toggleZoom" data-calculator-zoom-type-param="zoomOut">
                    <%= image_tag("calculator_img/zoom_out.png") %>
                  </button>
                  <button class="mt-2 mb-2" data-action="click->calculator#toggleAutorotate">
                    <%= image_tag("calculator_img/rotate.png") %>
                  </button>
                  <button class="mt-2 mb-2" data-action="click->calculator#toggleGrid">
                    <%= image_tag("calculator_img/grid.png") %>
                  </button>
                </div>
                <div class="absolute top-8 right-8" data-calculator-target="axesContainer"></div>
              </div>

              <button data-action="click->sidebar#toggle" class="relative w-full h-14 mt-10 bg-yellow-400 flex lg:hidden justify-center items-center rounded-lg text-base px-3 text-center sm:px-0 sm:text-xl font-medium uppercase cursor-pointer">
                <div class="w-6">
                  <%= image_tag("calculator_img/settings.png") %>
                </div>
                <h4 class="ml-2 font-medium">
                  <%= t("calculator.subtitles.settings") %>
                </h4>
              </button>
              
              <div class="model_details mt-6 text-gray-800">
                <div class="flex flex-col flex-col-reverse justify-between items-center lg:flex-row">
                  <div class="flex items-center">
                    <div class="w-7 mr-3">
                      <%= image_tag("calculator_img/cube.png") %>
                    </div>
                    <h4>
                      <%= t("calculator.subtitles.characteristics") %>
                    </h4>
                  </div>
                  <button style="border: blue" class="w-full lg:w-1/4 h-14 lg:h-12 change-model flex lg:justify-center items-center mb-8 lg:mb-0 px-4 py-2 border-2 border-zinc-800 rounded-xl font-medium uppercase relative">
                    <%= f.input :file, as: :file, label: false, input_html: { id: "file", accept: ".stl", required: true, class: "w-full h-full absolute top-0 left-0 opacity-0 cursor-pointer", data: { action: "change->calculator#onDropFile" } } %>
                    <div class="flex items-center mx-auto">
                      <p class="mr-2">
                        <%= image_tag("calculator_img/change_model.png") %>
                      </p>
                      <%= t("calculator.btns.change_model") %>
                    </div>
                  </button>
                </div>

                <div class="w-full h-0.5 bg-zinc-300 my-4"></div>
                  <div class="model-parametres flex flex-col lg:flex-row justify-between">
                    <div class="w-full lg:w-2/5">
                      <div class="flex flex-col lg:flex-row justify-between items-center my-4">
                        <p class="w-full lg:w-fit text-center lg:text-start">
                          <%= t("calculator.model.characteristics.model") %>
                        </p>
                        <p class="w-[172px] truncate text-center md:text-left" data-calculator-target="name">Baby_Groot_Planter.stl</p>
                      </div>
                      <div class="flex flex-col lg:flex-row justify-between items-center my-4">
                        <p class="w-full lg:w-fit text-center lg:text-start">
                          <%= t("calculator.model.characteristics.dimensions") %>
                        </p>
                        <p class="w-1/2 text-center md:text-left" data-calculator-target="size">42 x 32 x 14 cм</p>
                      </div>
                      <div class="flex flex-col lg:flex-row justify-between items-center my-4">
                        <p class="w-full lg:w-fit text-center lg:text-start">
                          <%= t("calculator.model.characteristics.volume") %>
                        </p>
                        <p class="text-center w-1/2 md:text-left" data-calculator-target="volume">
                          18,35 см
                          <sup>3</sup>
                        </p>
                      </div>
                    </div>
                    <div class="w-full lg:w-2/5">
                      <div class="flex flex-col lg:flex-row justify-between items-center my-4">
                        <p class="w-full lg:w-fit text-center lg:text-start">
                          <%= t("calculator.model.characteristics.area") %>
                        </p>
                        <p class="text-center w-[100px] md:text-left">
                          347,12 см
                          <sup>3</sup>
                        </p>
                      </div>
                      <div class="flex flex-col lg:flex-row justify-between items-center my-4">
                        <p class="w-full lg:w-fit text-center lg:text-start">
                          <%= t("calculator.model.characteristics.consumptions") %>
                        </p>
                        <p class="w-[100px] text-center md:text-left" data-calculator-target="consumption">66,44</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <div class="w-full h-full min-h-fit overflow-auto lg:w-1/3 xl:ml-10 text-base bg-white px-8 pt-6 pb-8 xl:rounded-2xl fixed xl:relative z-40 inset-y-0 left-0 transform xl:transform-none -translate-x-full transition duration-700 ease-in-out" data-sidebar-target="sidebarContainer" data-expanded="1">
            <section data-upload-model-target="settingsContainer" class="sidebar relative">
              <div class="close-btn absolute top-0 -right-4 block xl:hidden" data-action="click->sidebar#toggle">
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </div>
              <div class="flex items-center">
                <div class="w-6">
                  <%= image_tag("calculator_img/settings.png") %>
                </div>
                <h4 class="ml-2 font-medium">
                  <%= t("calculator.subtitles.settings") %>
                </h4>
                <div class="settings-close"></div>
              </div>
              <p class="text-gray-500 mt-4">
                <%= t("calculator.settings.desc") %>
              </p>
              <div class="w-full h-0.5 bg-zinc-200 my-4"></div>
              <div class="settings__content">
                <%= f.fields_for :print_model_attributes do |attribute_field| %>
                  <%= attribute_field.input :color, as: :hidden, input_html: { required: true, data: { calculator_target: "colorField" } } %>
                  <%= attribute_field.input :subtotal_price, as: :hidden, input_html: { data: { calculator_target: "subtotalPriceField" } } %>
                  <div class="settings__visual">
                    <div class="colors">
                      <h5 class="text-gray-500">
                        <%= t("calculator.settings.subtitles.color") %>
                      </h5>
                      <div class="colors-wrapper">
                        <div class="flex-auto">
                          <div class="flex colors justify-between">
                            <% ApplicationHelper::COLORS.each do |color| %>
                              <div class="w-8 h-8 cursor-pointer rounded-full border" data-action="click->calculator#setColor" data-calculator-color-param="<%= color %>" style="background-color: <%= "##{color}" %>"></div>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="w-full h-0.5 bg-zinc-200 my-4"></div>
                    <div>
                      <div class="mt-2 mb-4">
                        <h4 class="text-gray-500 mb-2">
                          <%= t("calculator.settings.subtitles.material") %>
                        </h4>
                        <%= attribute_field.input :material, label: false, collection: ApplicationHelper::MATERIALS, value_method: proc { |m| m.downcase }, input_html: { class: "w-full rounded", data: { action: "change->calculator#setMaterial" } }, required: true %>
                      </div>
                      <div class="mt-2 mb-4">
                        <h4 class="text-gray-500 mb-2">
                          <%= t("calculator.settings.subtitles.quality") %>
                        </h4>
                        <%= attribute_field.input :quality, label: false, collection: ApplicationHelper::QUALITY, label_method: proc { |q| "#{q} micron" }, input_html: { class: "w-full rounded", data: { action: "change->calculator#setQuality" } }, required: true %>
                      </div>
                    </div>
                  </div>

                  <div data-upload-model-target="orderContainer">
                    <div class="w-full h-0.5 bg-zinc-300 my-6"></div>
                    <div class="flex items-center">
                      <%= image_tag("partials_img/payment.png") %>
                      <h4 class="ml-2 font-medium">
                        <%= t("calculator.settings.estimated_cost") %>
                      </h4>
                    </div>
                    <div class="flex justify-between items-center my-6 font-medium text-xl">
                      <h4>
                        <%= t("calculator.settings.approximately") %>
                      </h4>
                      <h4 data-calculator-target="price">
                        <%= t("calculator.settings.price_placeholder", price: "від ₴ 1") %>
                      </h4>
                    </div>
                    <button class="w-full h-14 mt-10 bg-yellow-400 flex justify-center items-center rounded-lg text-base px-3 text-center sm:px-0 sm:text-xl font-medium uppercase cursor-pointer">
                      <%= t("calculator.btns.order_print") %>
                    </button>
                  </div>
                <% end %>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>